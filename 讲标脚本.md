## 可行性研究
  - 首先我先介绍下鸿蒙的发展历程。
      - 2017 年华为发布了鸿蒙1.0内核， 主要是内核的技术验证
      - 2018 年华为发布鸿蒙 2.0内核，并公布了对应的开源版本。重点是TEE（可信环境引擎），用于比如生物验证等对安全要求高的环境。
      - 2019 年，鸿蒙 1.0正式开始大量实装在华为手机上，基于之前的开源版本打造， 重点是底层的特性。聚焦微内核TEE 的验证使用，方舟引擎，可确定性延迟。面向应用层的多终端 IDE 开始 Beta 测试。
      - 2020 年，鸿蒙 2.0正式发布了多终端 IDE，开始提供自研的应用层框架，基于方舟引擎提供的多语言统一编译能力，从此可以开发普通用户最常接触的 App。另外基于方舟图形引擎，重点提高了图形性能，并满足车规要求。
      - 2022 年, 时隔两年后，鸿蒙 3.0重点进行了软硬件协同的适配，包含文件系统加速，新的分布式架构，高性能的 IPC 设计。
      - 2023 年，鸿蒙 4.0 提供了盘古大模型，用于AI 加速，新的鸿蒙内核，以及应用层全新设计的 Ark Engine, 鸿蒙正式确认 ArkTS 成为应用层指定的开发语言。
      - 2024 年，华为正式宣布Harmony OS Next，中文名鸿蒙星河版。正式宣布取消对安卓的兼容，进化为纯血鸿蒙。从系统到应用层，完全由华为全栈自研。预计将于年底正式投入使用。
  - 最新的纯血鸿蒙提供如下完整的底层支持，包含：
      - 用于用户开发的 DevEco IDE，用于从开发到测试验证到最终上线的全链路的支持
      - 用于构建应用的 Ark 系列，包含开发语言 ArkTS，编译器 ArkCompiler，UI 框架 ArkUI
      - 系统架构从上到下，大致分为三大块，最上面是应用层，包含我们常用的系统应用，比如设置，应用商店，以及三方开发的 app。中间是系统框架，给应用层提供诸如定位，AI，安全认证等能力。底层是系统内核，是操作系统和硬件对接的部分。
      - 通过这些基础设施，华为生态提供了三大能力：
          - 一次开发，多端部署。在 DevEco 的帮助下，我们可以针对手机，平板，手表等多终端写代码。完成多端测试验证，上线部署。
          - 可分可合 DevEco 推荐的多模块模式下，多个终端可以任何组合 hap/hap 构建产物，完成多端的代码复用。
          - 自由流转包含两个场景，一个是多设备的数据流转。比如头脑风暴在手机上记录草稿，然后回去草稿会流转到电脑上继续整理。另外一个是多设备之间的协作，比如可以把手机作为平板的摄像头进行人脸识别的验证。
          - 统一生态，原生智能。则是华为通过 Ark 框架提供了系统框架层的统一支持，通过系统提供的 AI 等能力，用户使用的时间越久，鸿蒙设备对你的了解和配合就越默契。比如系统会习惯你的作息，来平衡设备的充电和性能优化时间；系统会习惯你的操作，从而进行针对性加速；
  - 目前鸿蒙的统一的框架如下：
      - 首先最下面是多种形态的设备，包含手表，手机，平板，PC 等等，他们均运行鸿蒙系统，通过鸿蒙提供的系统服务，对应用层进行统一的支持。
      - 目前华为的鸿蒙和开源鸿蒙是一个互补的关系，鸿蒙本身是闭源的，华为投入实现的能力，会反哺开源鸿蒙；同时开源鸿蒙社区的工作成果，也会合并到华为的鸿蒙里面。实现共同成就。
      - 华为统一框架下，对各种开发框架进行了一视同仁的支持，包含原生的 ArkUI，已经三方的诸如 Flutter 等开发框架。从而方便合作生态企业自由选择。
  - 目前，华为和合作企业正在推进很多 app 登录纯血鸿蒙：
      - 从 2023 年八月份，华为 Mate60 发布开始，基于预览版华为已经开始对接很多头部公司
      - 2024 年一月，华为正式公布了鸿蒙星河版，并宣布年底商用，会上公布200+的 App 正式宣布接入鸿蒙。比如高德地图，BiliBili 等等。另外有头部 5000+正在路上
      - 根据华为的计划，预计2024 年 6 月，鸿蒙将开始 Beta 测试，8 月份 进行 RC 测试，年底正式商用
  - 目前 BMW app 的整体架构如图：
      - 周边是各个独立的模块，如Joy_UI, Atlas, Car_connection等等，中间是通用的 platform sdk 模块，下面是各个业务的 feature module，这些都是基于 flutter 实现。
      - 右边是我们的 OMC 网关，用于和服务端进行通信。
      - 顶部是和特定的平台进行集成的工程配置。包含符合特定平台格式的 app shell，作为承载启动的容器，中间是 main 启动流程，左边是三个移动操作系统平台。而本次的工作就是新增鸿蒙的平台。
  - 具体而言，把BMW app 迁移到鸿蒙，我们有如下考量：
      - 首先是原因。在BMW目前的安卓平台中，有很大一部分是华为用户，这部分用户作为华为的粉丝，未来也很可能继续使用华为的手机。那么当未来的鸿蒙不再兼容安卓后，BMW 对这些用户在新的平台上继续提供服务，体现了宝马对用户的负责。
      - 第二点是时机。考虑到华为的商业计划，鸿蒙将在今年底商用，我们综合考虑了开发，测试，发布的全流程，预计在 2025 年的年初或者更早完成对鸿蒙的支持。
      - 第三点是任务拆分。我们打算从一下几个大的方面去落实对鸿蒙的支持：
          - 首先是可行性分析，我们将重点评估 BMW 现在使用的 Flutter 技术栈在鸿蒙上的可行性，然后进行和原生开发技术栈进行对比。
          - 然后是组建团队，对着两项技术做深度调研并给出调研结论。
          - 接下来进入开发和测试工作。
          - 最后发布上架，并持续维护。
  - 我们对 Flutter 和鸿蒙原生开发做了一个多维度的比对：
      - 在鸿蒙系统上，Flutter 作为 UI 框架，地位类似于原生的 ArkUI。二者都是声明式 UI 框架。后者也明确借鉴了前者的开发理念。
      - 具体的图形引擎，Flutter 使用 Impeller 或者 Skia 来渲染，而原生使用华为研究数年的方舟引擎。
      - 在底层的图形 API 方面，二者使用了相同的接口，也就是 Open GL或者 Vulkan，这两者是并存的，使用哪一个，取决于 Flutter， ArkUI以及系统内置的版本。
      - 在运行态方面，鸿蒙原生基于方舟编译器，使用 JIT 编译为机器码，而 Flutter 使用 AOT 提前编译为机器码。Flutter 相对更加省电。
      - 在图形性能方面，根据我们对测试版鸿蒙自带的系统应用和 Flutter 测试 demo 对比，Flutter 要更胜一筹，原生这边随着华为的持续打磨，相信未来会更好，更稳定。
      - 安全方面，原生直接对接了鸿蒙的系统安全能力，而 Flutter 同样可以使用插件来复用系统的安全能力，所以本质是一样的。
      - 更新频率方面，原生类似 iOS/Android 的策略，一年更新一个API，Flutter 目前由华为维护，也是一年打算更新一个版本，未来鸿蒙影响力变大获得 google 官方支持后，更新还会更频繁，大概一年 4 次。
      - 多平台 UI 一致性方面，目前原生处于 beta 测试状态，需要磨合。Flutter 这边则可以完全复用 UI代码，做到 iOS/Android/鸿蒙多端一致。
      - MVP0 功能集合：原生因为要从零开发，支持的功能较少。Flutter 因为复用了大部分代码，功能会多很多。
      - 代码复用层面，鸿蒙原生因为开发语言都换了，代码复用度接近于零。而 Flutter 所有的 Dart 代码都可以复用，在整个 app 的代码中占比大概超过 9 成。
      - 架构层面，二者都是多模块的分层架构，是一致的。
      - 可能阻塞方面：原生是华为官方支持，阻塞可能很小。Flutter 这边由华为和阿里巴巴等合作伙伴共同落地，阻塞可能也很小。
      - 开发体验：原生有完整的 IDE 支持，具有较好的调试开发体验。Flutter 这边的支持还不太完善，变动的方法是借助安卓来调试 Dart 代码， 借助原生来调试Plugin 代码。
      - 未来愿景：
          - 随着鸿蒙影响力逐渐扩大，相信鸿蒙终将跻身世界三大移动操作系统，开发工具等支持将越来越完善。
          - Flutter 这边，短期内将获得华为和合作伙伴的支持，长期来看随着鸿蒙系统的影响力越来越大，终将获得 Flutter 官方的支持。
  - 总结而言：
      - 鸿蒙原生的优势是：拥有完善的开发和调试工具链，ArkUI 内置了对多种屏幕形态的响应式支持，以及来自华为官方的大力支持。
      - 鸿蒙原生的劣势是：代码复用度接近零，需要巨大重新设计，重新开发的成本。另外后续维护鸿蒙原生和现有的 Flutter 两套工程，也将带来较大的成本开销。
      - Flutter 的优势是：总体工程九成以上的代码复用度，媲美原生的性能，极高的多平台功能一致性。以及维护一套 Flutter 巨大的成本优势。
      - Flutter 的劣势是：当前 Flutter 是华为和阿里巴巴等合作维护的一个分支，还没有获得 Flutter 官方的支持。（未来随着鸿蒙的影响力变大，将很有可能获得来自 google 的支持）
  - 针对 Flutter 的实现，我们也列出了一个图，来简单直观的呈现 Flutter on 鸿蒙的支持：
      - 首先，我们会 100% 复用现在的 Flutter 代码，也就是用 Dart 书写的代码。
      - 再此基础上，添加针对鸿蒙的 Plugin，用来沟通 Dart 和原生的 ArkTs 语言。
      - 最后，我们把这些装在一个针对鸿蒙的 App Shell里面, 从而确保符合鸿蒙的 app 安装格式。
      - 至此，我们的 BMW app 就可以运行在纯血鸿蒙系统上。
  - 为了验证 Flutter 可行度，我们在技术层面拆分了6个验证的维度：
      - 编译验证，确保 Flutter 可以和原生 Shell 一起构建可运行的 app
      - 运行验证，确保编译的产物可以运行在鸿蒙星河版上
      - Dart 网络 IO 验证，确保端到端的网络调用是正常的
      - Dart 磁盘 IO 验证，我们将结合 BMW 使用的 Bloc 框架使用 HIVE 框架，确保 Dart IO在磁盘操作上正常
      - 插件验证，我们将验证插件中联通 Dart 和 ArkTS 的三个 channel，分别是 MethodChannel，EventChannel 和标准编码 Channel。
      - 最后是 UI 渲染验证，我们将基于 Joy_UI,确保图片/文字等基本渲染正常，并确保阴影/纹理等高级渲染正常。
      - 以上六个维度，全面验证了 Flutter 引擎和 鸿蒙系统 的契合程度，从而确保我们坐落于引擎之上的业务运行正常。
  - 目前我们对以上的验证已经有了实际的操作，总结如下：
      - 技术方面，我们对以上 6 个维度都进行了测试，确认了 Flutter 可以在鸿蒙系统上正常的运行。
      - 安全层面，Flutter 使用插件沟通原生，可以复用鸿蒙系统的所有安全能力。
      - 平台特性，Flutter 通过插件可以使用系统所有的能力。
      - 性能方面：Flutter 基于 AOT 编译，提前编译为机器码，和 GPU 直接对接，没有系统额外的中间转换，拥有很高的性能。
      - 官方支持：目前 Flutter 处于华为和阿里巴巴等社区的共同支持下，未来随着鸿蒙跻身世界三大移动操作系统，很有可能会获取 Flutter 官方的支持。
  - 基于以上， 我们预估了开发的时间节点安排和人员需求：
      - 考虑到鸿蒙商业化的节点，我们初步设想了 BMW 这边，使用三个月时间，到七月底前进行可行性的深度调研。年底前完成开发工作。然后趁着鸿蒙正式上线，我们很方便进行测试验证工作，并在 Q1 完成上线。
      -  考虑到无论使用 Flutter 还是原生，二者在原理上是高度类似的，人员需求和现有的 BMW app是一致的。
## 微创合作伙伴很多已经开始鸿蒙的适配工作，以下是 5 个例子：
- WISE，一个多渠道交易平台
    - 目前针对鸿蒙 WISE 已经做了单独的开发适配
    - 目前的功能包含登录，首页，产品列表，购物车，支付等等。
    - 通过锁屏，推送，小艺助手等系统能力，实现了促销活动的提醒服务，基于系统定位服务实现了订单的物流提醒。
    - 并且当前实现了手机，手表，平板的适配。
- OA （APP），一个办公自动化 app
    - 这是一个聚焦办公效率的 app，提供把线下OA流程转为线上流程，以及无纸化办公能力。目前包含了流程，消息，通信录和个人中心功能。
    - 流程包含了常见的OA 流程，签到，流程管理，报告等功能。
    - 消息：整合了办公中的消息，直达相关人员，方面浏览。
    - 通信录：提供了组织，同事，部门等多个维度，方面查找。
    - 个人中心用于记录，修改，查看个人的各种信息。
- 高德地图：
    - 高德地图是中国广为人知的地图服务 app，提供导航，搜索，打车，生活服务等各种功能。
    - 涉及到的技术栈很多，牵扯的测试流程，测试数据，测试容器等基础设施庞大。
    - 微创相关部门有 80 名工程师参与了高德北京团队的各项工作。涵盖了高德研发/测试链条的方方面面。
    - 目前鸿蒙版本的高德地图已经上架，功能正在迭代增加中
- Bilibili：
    - Bilibili 是中国著名的视频平台，提供了类似 youtube 的视频点播/直播能力
    - 从 2017 年开始，微创和 Bilibili 合作依赖，伴随着 B 站的告诉增长，现在 B 站把这种体验带到了鸿蒙平台。
    - 微创有 100 多名员工，深度参与了 Bilibili on 鸿蒙的工作。
    - 利用鸿蒙系统杰出的分布式体验，原生智能，安全可靠和大模型 AI 能力等等，提供了崭新的用户体验。
    - 目前鸿蒙版本的Bilibili已经上架，功能正在迭代增加中
- 舍弗勒App：
    - 舍弗勒是一个汽车配件领域的杰出企业，其 app 以在线交易为核心，拓展舍弗勒直达用户的能力。
    - App 有两个版本，一个是面向消费者的客户端版本，另外一个是面向供应商的版本。
    - 舍弗勒 App 也是基于 Flutter 开发的，目前针对鸿蒙的版本正在开发中。
- 目前微创有越来越多的员工正在掌握鸿蒙开发的能力。他们中陆续有人获得了华为的高级开发认证。
    - 微创也有能力针对客户需求，提供专业的培训服务。

## 最后我想针对适配鸿蒙这个问题提供下我们的一些思考和建议：
    - 从商业角度来说，华为是 BMW 很多车主的选择。当鸿蒙推向市场，BMW 继续向这部分车主提供强力的支持，体现了我们对车主的支持和尊重，BMW也终将收获车主的支持和尊重。
    - 从技术角度而言，立足于现有的 Flutter 跨平台技术，我们将以较低的成本向 BMW 的用户提供多端一致的体验，这些平台包含 iOS，安卓和鸿蒙，我们将一视同仁。
    - 从社区的角度而言，Flutter 在华为以及包含阿里巴巴等社区成员的支持下，我们将避免阻塞性风险，并收获稳定的安全/功能等更新。
    - 从生态的角度而言，微创和很多商业伙伴有深入的合作。在迁移鸿蒙的过程中，他们中的有些公司比如阿里的闲鱼，腾讯的 QQ 阅读等等，拥有丰富的Flutter跨平台迁移的能力和经验，而这些能力将是微创可以提供和复用的重要生态。





    


